<view class="{{['container','data-v-421059c6',[(dragScrollLock)?'container--drag-locked':''],[(containerFixed)?'container--fixed':'']]}}" style="{{'top:'+(containerHeightPx?containerTopPx+'px':'')+';'+('height:'+(containerHeightPx?containerHeightPx+'px':'')+';')+('transform:'+(headHidePx?'translateY('+-headHidePx+'px)':'')+';')}}"><view data-event-opts="{{[['touchstart',[['onEdgeTouchStart',['$event']]]],['touchmove',[['onGlobalTouchMove',['$event']]]],['touchend',[['onGlobalTouchEnd',['$event']]]],['touchcancel',[['onGlobalTouchCancel',['$event']]]]]}}" class="{{['page','data-v-421059c6',(dragScrollLock)?'page--drag-locked':'']}}" bindtouchstart="__e" bindtouchmove="__e" bindtouchend="__e" bindtouchcancel="__e"><view class="main data-v-421059c6"><scroll-view class="left data-v-421059c6" scroll-y="{{!dragScrollLock}}" enhanced="{{true}}" bounces="{{false}}" enable-flex="{{true}}" data-event-opts="{{[['scroll',[['onLeftScroll',['$event']]]]]}}" bindscroll="__e"><block wx:for="{{categories}}" wx:for-item="c" wx:for-index="__i0__" wx:key="id"><view data-event-opts="{{[['tap',[['selectCategory',['$0'],[[['categories','id',c.id]]]]]],['longpress',[['beginDragCategory',['$event','$0'],[[['categories','id',c.id]]]]]]]}}" class="{{['data-v-421059c6','cat',selectedCategory&&selectedCategory.id===c.id?'cat--active':'',isDragging&&dragItem&&dragItem.__dragType==='category'&&dragItem.id===c.id?'cat--dragging':'']}}" bindtap="__e" bindlongpress="__e"><block wx:if="{{selectedCategory&&selectedCategory.id===c.id}}"><view class="cat-ind data-v-421059c6"></view></block><text class="cat__txt data-v-421059c6">{{c.name}}</text></view></block><view data-event-opts="{{[['tap',[['showAddCategoryDialog',['$event']]]]]}}" class="cat cat--add data-v-421059c6" bindtap="__e"><view class="dots-container data-v-421059c6"><view class="dot dot-small data-v-421059c6"></view><view class="dot dot-large data-v-421059c6"></view><view class="dot dot-small data-v-421059c6"></view></view></view><block wx:if="{{nid===0||nid===1||nid===3}}"><view data-event-opts="{{[['tap',[['handleBatchDownload',['$event']]]]]}}" class="cat cat--download data-v-421059c6" bindtap="__e"><text class="cat__txt cat__txt--batch data-v-421059c6">ğŸ“¥ æ‰¹é‡ä¸‹è½½</text></view></block><block wx:if="{{nid===2}}"><view data-event-opts="{{[['tap',[['showBatchOutboundModal']]]]}}" class="cat cat--batch-out data-v-421059c6" bindtap="__e"><text class="cat__txt cat__txt--batch data-v-421059c6">ğŸ“¦ æ‰¹é‡å‡ºåº“</text></view></block></scroll-view><view class="right data-v-421059c6"><view class="right__title right__title--sticky data-v-421059c6"><text class="right__title__txt data-v-421059c6">{{selectedCategory?selectedCategory.name:''}}</text><view class="title-buttons data-v-421059c6"><view data-event-opts="{{[['tap',[['handleSmartAction',['$event']]]]]}}" class="smart-action-btn data-v-421059c6" bindtap="__e"><view class="dots-container data-v-421059c6"><view class="dot dot-small data-v-421059c6"></view><view class="dot dot-large data-v-421059c6"></view><view class="dot dot-small data-v-421059c6"></view></view></view></view></view><scroll-view class="right__list data-v-421059c6" style="{{(rightListHeightPx?'height:'+rightListHeightPx+'px':'')}}" scroll-y="{{!dragScrollLock}}" enhanced="{{true}}" bounces="{{false}}" enable-flex="{{true}}" data-event-opts="{{[['scroll',[['onRightScroll',['$event']]]]]}}" bindscroll="__e"><block wx:for="{{$root.l0}}" wx:for-item="m" wx:for-index="idx" wx:key="id"><block class="data-v-421059c6"><view data-event-opts="{{[['longpress',[['beginDragMaterial',['$event','$0',idx],[[['flatMaterials','id',m.$orig.id]]]]]]]}}" class="{{['data-v-421059c6','row',isDragging&&dragItem&&dragItem.__dragType==='material'&&dragItem.id===m.$orig.id?'row--dragging':'']}}" bindlongpress="__e"><view class="row__info data-v-421059c6"><view class="row__line data-v-421059c6"><text class="lbl data-v-421059c6">ç¼–ç ï¼š</text><text class="val data-v-421059c6">{{m.$orig.code}}</text></view><view class="row__line data-v-421059c6"><text class="lbl data-v-421059c6">æ•°é‡ï¼š</text><text class="{{['val','data-v-421059c6',(nid===1&&m.$orig.quantity<0)?'negative-quantity':'']}}">{{m.$orig.quantity}}</text><block wx:if="{{nid===1}}"><view data-event-opts="{{[['tap',[['showCalculationDetail',['$0'],[[['flatMaterials','id',m.$orig.id]]]]]]]}}" class="quantity-detail data-v-421059c6" bindtap="__e"><view class="qd-bar qd-bar--a data-v-421059c6"></view><view class="qd-bar qd-bar--b data-v-421059c6"></view><view class="qd-bar qd-bar--c data-v-421059c6"></view><view class="qd-bar qd-bar--d data-v-421059c6"></view></view></block></view><view class="row__line data-v-421059c6"><text class="lbl data-v-421059c6">{{nid===2?'éƒ¨é—¨ï¼š':'æ‰¹æ¬¡ï¼š'}}</text><text class="val data-v-421059c6">{{nid===2?m.m0:m.$orig.batch||'-'}}</text></view><view class="row__line data-v-421059c6"><text class="lbl data-v-421059c6">è§„æ ¼ï¼š</text><text class="val data-v-421059c6">{{m.$orig.spec||'-'}}</text></view></view><view class="row__ops data-v-421059c6"><block wx:if="{{nid===2}}"><view data-event-opts="{{[['tap',[['editMaterial',['$0'],[[['flatMaterials','id',m.$orig.id]]]]]]]}}" class="pill pill--blue data-v-421059c6" bindtap="__e">ä¿®æ”¹</view></block><block wx:if="{{nid===2}}"><view data-event-opts="{{[['tap',[['deleteMaterial',['$0'],[[['flatMaterials','id',m.$orig.id]]]]]]]}}" class="pill pill--orange data-v-421059c6" bindtap="__e">åˆ é™¤</view></block><block wx:if="{{nid!==2}}"><view data-event-opts="{{[['tap',[['openQty',['in','$0'],[[['flatMaterials','id',m.$orig.id]]]]]]]}}" class="pill pill--green data-v-421059c6" bindtap="__e">+</view></block><block wx:if="{{nid!==2}}"><view data-event-opts="{{[['tap',[['openQty',['out','$0'],[[['flatMaterials','id',m.$orig.id]]]]]]]}}" class="pill pill--red data-v-421059c6" bindtap="__e">-</view></block></view></view><block wx:if="{{idx<$root.g0-1}}"><view class="divider data-v-421059c6"></view></block></block></block></scroll-view></view></view><block wx:if="{{isDragging}}"><view class="drag-mask data-v-421059c6" catchtouchmove="__e" data-event-opts="{{[['touchmove',[['onDragMove',['$event']]]],['touchend',[['onDragEnd',['$event']]]],['touchcancel',[['onDragCancel',['$event']]]]]}}" catchtouchend="__e" catchtouchcancel="__e"><view class="drag-ghost data-v-421059c6" style="{{(ghostStyle)}}"><text class="ghost-text data-v-421059c6">{{dragItem?dragItem.code+' - '+dragItem.name:''}}</text></view><view class="{{['drag-delete-zone','data-v-421059c6',zoneSide==='bottom'?'from-bottom':'from-top',zoneVisible?'enter':'leave',isInDeleteZone?'drag-zone-active':'']}}" style="{{(zoneStyle)}}" id="deleteZone"><text class="drag-zone-icon data-v-421059c6">ğŸ—‘ï¸</text><text class="drag-zone-text data-v-421059c6">{{''+(isInDeleteZone?'æ¾æ‰‹åˆ é™¤':zoneSide==='bottom'?'æ‹–åˆ°è¿™é‡Œåˆ é™¤':'æ‹–åˆ°ä¸Šæ–¹åˆ é™¤')+''}}</text></view></view></block><block wx:if="{{drawerOpen||drawerDragging}}"><view data-event-opts="{{[['tap',[['closeDrawer',['$event']]]]]}}" class="drawer-overlay data-v-421059c6" bindtap="__e"></view></block><view class="{{['drawer','data-v-421059c6',[(drawerOpen)?'drawer--open':''],[(drawerDragging)?'drawer--dragging':'']]}}" style="{{'right:'+(drawerRightPx+'px')+';'}}"><view class="drawer-header data-v-421059c6"><text class="drawer-title data-v-421059c6">åŠŸèƒ½èœå•</text></view><view class="drawer-content data-v-421059c6"><view data-event-opts="{{[['tap',[['doSearch',['$event']]]]]}}" class="drawer-item data-v-421059c6" bindtap="__e"><text class="drawer-icon data-v-421059c6">ğŸ”</text><text class="drawer-text data-v-421059c6">æœç´¢</text></view><view data-event-opts="{{[['tap',[['goRecords',['$event']]]]]}}" class="drawer-item data-v-421059c6" bindtap="__e"><text class="drawer-icon data-v-421059c6">ğŸ“‹</text><text class="drawer-text data-v-421059c6">è®°å½•</text></view><view data-event-opts="{{[['tap',[['closeDrawer',['$event']]]]]}}" class="drawer-item data-v-421059c6" bindtap="__e"><text class="drawer-icon data-v-421059c6">âœ•</text><text class="drawer-text data-v-421059c6">å…³é—­</text></view></view><view class="drawer-footer data-v-421059c6"></view></view><block wx:if="{{$root.g1}}"><view data-event-opts="{{[['tap',[['openCart',['$event']]]]]}}" class="fab fab--cart data-v-421059c6" style="{{'bottom:'+(fabBottomPx+'px')+';'}}" bindtap="__e"><text class="cart data-v-421059c6">ğŸ›’</text><view class="badge data-v-421059c6">{{cartCount}}</view></view></block><custom-keyboard vue-id="00094000-1" show="{{qtyDialog}}" materialInfo="{{opMat}}" operationType="{{opType==='in'?'inbound':'outbound'}}" value="{{qtyStr}}" data-event-opts="{{[['^updateShow',[['e0']]],['^confirm',[['confirmQty']]],['^cancel',[['closeQty']]],['^input',[['__set_model',['','qtyStr','$event',[]]]]]]}}" bind:updateShow="__e" bind:confirm="__e" bind:cancel="__e" bind:input="__e" class="data-v-421059c6" bind:__l="__l"></custom-keyboard><block wx:if="{{cartOpen}}"><view data-event-opts="{{[['tap',[['closeCart',['$event']]]]]}}" class="mask data-v-421059c6" bindtap="__e"></view></block><block wx:if="{{cartOpen}}"><view class="cart-panel data-v-421059c6" style="{{'bottom:'+(cartBottomPx+'px')+';'}}"><view class="cart-title data-v-421059c6">è´­ç‰©è½¦æ¸…å•</view><scroll-view class="cart-list data-v-421059c6" scroll-y="{{true}}" enable-flex="{{true}}"><block wx:for="{{$root.l1}}" wx:for-item="it" wx:for-index="i" wx:key="id"><view class="cart-item data-v-421059c6"><view class="cart-item-info data-v-421059c6"><text class="ci-name data-v-421059c6">{{it.$orig.name}}</text><text class="ci-code data-v-421059c6">{{it.$orig.code}}</text><text class="{{['ci-qty','data-v-421059c6',it.$orig.delta>0?'in':'out']}}">{{''+(it.$orig.delta>0?'å…¥åº“+'+it.$orig.delta:'å‡ºåº“'+it.g2)+''}}</text><block wx:if="{{it.$orig.meta&&it.$orig.meta.departmentName}}"><text class="ci-code data-v-421059c6">{{'éƒ¨é—¨ï¼š'+it.$orig.meta.departmentName+''}}<block wx:if="{{it.$orig.meta.bomName}}"><text class="data-v-421059c6">{{"/ BOMï¼š"+it.$orig.meta.bomName}}</text></block></text></block></view><view class="cart-item-action data-v-421059c6"><view data-event-opts="{{[['tap',[['removeCartItem',['$0'],[[['cartList','id',it.$orig.id,'id']]]]]]]}}" class="delete-btn data-v-421059c6" bindtap="__e">åˆ é™¤</view></view></view></block></scroll-view><view class="cart-footer data-v-421059c6"><view class="cart-summary data-v-421059c6"><text class="summary-text data-v-421059c6">{{"å…± "+cartCount+" é¡¹"}}</text></view><view class="cart-actions data-v-421059c6"><view data-event-opts="{{[['tap',[['clearCart',['$event']]]]]}}" class="ca-btn ca-clear data-v-421059c6" bindtap="__e">æ¸…ç©º</view><view data-event-opts="{{[['tap',[['checkout',['$event']]]]]}}" class="ca-btn ca-checkout data-v-421059c6" bindtap="__e">ç»“ç®—</view></view></view></view></block><block wx:if="{{showAddCategoryModal}}"><view data-event-opts="{{[['tap',[['closeAddCategoryModal',['$event']]]]]}}" class="modal-mask data-v-421059c6" bindtap="__e"></view></block><block wx:if="{{showAddCategoryModal}}"><view class="add-category-modal data-v-421059c6" style="{{'transform:'+('translate(-50%, -50%) translateY('+-modalShiftPx+'px)')+';'}}"><view class="modal-title data-v-421059c6">æ–°å¢</view><view class="modal-content data-v-421059c6"><view class="input-row data-v-421059c6"><text class="input-label data-v-421059c6">åç§°ï¼š</text><input class="input-field data-v-421059c6" placeholder="è¯·è¾“å…¥åç§°" maxlength="20" data-event-opts="{{[['input',[['__set_model',['','newCategoryName','$event',[]]]]]]}}" value="{{newCategoryName}}" bindinput="__e"/></view></view><view class="modal-actions data-v-421059c6"><view data-event-opts="{{[['tap',[['closeAddCategoryModal',['$event']]]]]}}" class="modal-btn modal-cancel data-v-421059c6" bindtap="__e">å–æ¶ˆ</view><view data-event-opts="{{[['tap',[['confirmAddCategory',['$event']]]]]}}" class="modal-btn modal-confirm data-v-421059c6" bindtap="__e">ç¡®è®¤</view></view></view></block><block wx:if="{{showAddMaterialModal}}"><view data-event-opts="{{[['tap',[['closeAddMaterialModal',['$event']]]]]}}" class="modal-mask data-v-421059c6" bindtap="__e"></view></block><block wx:if="{{showAddMaterialModal}}"><view class="add-material-modal data-v-421059c6" style="{{'transform:'+('translate(-50%, -50%) translateY('+-modalShiftPx+'px)')+';'}}"><view class="modal-title data-v-421059c6">æ–°å¢ææ–™</view><view class="modal-content data-v-421059c6"><view class="input-row data-v-421059c6"><text class="input-label data-v-421059c6">ææ–™ç¼–ç ï¼š</text><input class="input-field data-v-421059c6" placeholder="è¯·è¾“å…¥ææ–™ç¼–ç " maxlength="30" data-event-opts="{{[['input',[['__set_model',['$0','code','$event',[]],['newMaterial']]]]]}}" value="{{newMaterial.code}}" bindinput="__e"/></view><view class="input-row data-v-421059c6"><text class="input-label data-v-421059c6">åˆå§‹æ•°é‡ï¼š</text><input class="input-field data-v-421059c6" placeholder="è¯·è¾“å…¥åˆå§‹æ•°é‡" type="number" data-event-opts="{{[['input',[['__set_model',['$0','quantity','$event',[]],['newMaterial']]]]]}}" value="{{newMaterial.quantity}}" bindinput="__e"/></view><view class="input-row data-v-421059c6"><text class="input-label data-v-421059c6">æ‰¹æ¬¡ï¼š</text><input class="input-field data-v-421059c6" placeholder="è¯·è¾“å…¥æ‰¹æ¬¡ï¼ˆå¦‚ï¼š20250927ï¼‰" maxlength="8" type="number" data-event-opts="{{[['input',[['__set_model',['$0','batch','$event',[]],['newMaterial']]]]]}}" value="{{newMaterial.batch}}" bindinput="__e"/></view><view class="input-row data-v-421059c6"><text class="input-label data-v-421059c6">è§„æ ¼ï¼š</text><input class="input-field data-v-421059c6" placeholder="è¯·è¾“å…¥è§„æ ¼" maxlength="100" data-event-opts="{{[['input',[['__set_model',['$0','spec','$event',[]],['newMaterial']]]]]}}" value="{{newMaterial.spec}}" bindinput="__e"/></view></view><view class="modal-actions data-v-421059c6"><view data-event-opts="{{[['tap',[['closeAddMaterialModal',['$event']]]]]}}" class="modal-btn modal-cancel data-v-421059c6" bindtap="__e">å–æ¶ˆ</view><view data-event-opts="{{[['tap',[['confirmAddMaterial',['$event']]]]]}}" class="modal-btn modal-confirm data-v-421059c6" bindtap="__e">ç¡®è®¤</view></view></view></block><block wx:if="{{showCalculationModal}}"><view data-event-opts="{{[['tap',[['closeCalculationModal',['$event']]]]]}}" class="modal-overlay data-v-421059c6" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="calculation-modal data-v-421059c6" catchtap="__e"><view class="modal-header data-v-421059c6"><text class="modal-title data-v-421059c6">{{(selectedMaterialForCalc?selectedMaterialForCalc.name:'')+' æ•°é‡è®¡ç®—è¯¦æƒ…'}}</text><view data-event-opts="{{[['tap',[['closeCalculationModal',['$event']]]]]}}" class="modal-close-btn data-v-421059c6" bindtap="__e">Ã—</view></view><view class="modal-content data-v-421059c6"><view class="calc-section data-v-421059c6"><text class="calc-title data-v-421059c6">ä¸»æä»“å‡ºåº“åˆ°ç”Ÿäº§éƒ¨é—¨ï¼š</text><block wx:for="{{$root.l2}}" wx:for-item="record" wx:for-index="__i1__" wx:key="id"><view class="calc-item data-v-421059c6"><text class="calc-dept data-v-421059c6">{{record.m1}}</text><text class="calc-quantity data-v-421059c6">{{"+"+record.$orig.quantity}}</text><text class="calc-date data-v-421059c6">{{record.$orig.date}}</text></view></block><view class="calc-total data-v-421059c6"><text class="calc-label data-v-421059c6">å‡ºåº“æ€»è®¡ï¼š</text><text class="calc-value data-v-421059c6">{{calculationDetails.totalOutbound}}</text></view></view><view class="calc-section data-v-421059c6"><text class="calc-title data-v-421059c6">BOMéœ€æ±‚æ•°é‡ï¼š</text><block wx:for="{{$root.l3}}" wx:for-item="req" wx:for-index="reqIdx" wx:key="reqIdx"><view class="calc-item data-v-421059c6"><text class="calc-dept data-v-421059c6">{{req.m2}}</text><text class="calc-quantity negative data-v-421059c6">{{"-"+req.$orig.requiredQuantity}}</text></view></block><view class="calc-total data-v-421059c6"><text class="calc-label data-v-421059c6">éœ€æ±‚æ€»è®¡ï¼š</text><text class="calc-value negative data-v-421059c6">{{"-"+calculationDetails.totalRequired}}</text></view></view><view class="calc-result data-v-421059c6"><text class="result-label data-v-421059c6">è½¦é—´ä»“å®é™…æ•°é‡ï¼š</text><text class="{{['result-value','data-v-421059c6',(calculationDetails.finalQuantity<0)?'negative':'']}}">{{''+calculationDetails.finalQuantity+''}}</text></view></view><view class="modal-actions data-v-421059c6"><view data-event-opts="{{[['tap',[['closeCalculationModal',['$event']]]]]}}" class="modal-btn modal-confirm data-v-421059c6" bindtap="__e">ç¡®å®š</view></view></view></view></block><block wx:if="{{showBatchOutboundDialog}}"><view data-event-opts="{{[['tap',[['closeBatchOutboundModal',['$event']]]]]}}" class="modal-overlay data-v-421059c6" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="batch-outbound-modal data-v-421059c6" catchtap="__e"><view class="modal-header data-v-421059c6"><text class="modal-title data-v-421059c6">æ‰¹é‡å‡ºåº“</text><view data-event-opts="{{[['tap',[['closeBatchOutboundModal',['$event']]]]]}}" class="modal-close-btn data-v-421059c6" bindtap="__e">Ã—</view></view><view class="modal-content data-v-421059c6"><view class="form-section data-v-421059c6"><text class="section-title data-v-421059c6">é€‰æ‹©éƒ¨é—¨ï¼š</text><view class="dept-selector data-v-421059c6"><block wx:for="{{productionDepartments}}" wx:for-item="dept" wx:for-index="__i2__" wx:key="code"><view data-event-opts="{{[['tap',[['selectOutboundDepartment',['$0'],[[['productionDepartments','code',dept.code]]]]]]]}}" class="{{['dept-item','data-v-421059c6',(selectedOutboundDepartment&&selectedOutboundDepartment.code===dept.code)?'dept-item--selected':'']}}" bindtap="__e"><text class="dept-name data-v-421059c6">{{dept.name}}</text></view></block></view></view><block wx:if="{{selectedOutboundDepartment}}"><view class="form-section data-v-421059c6"><text class="section-title data-v-421059c6">é€‰æ‹©æ‰¹å·ï¼š</text><view class="batch-selector data-v-421059c6"><block wx:for="{{availableBatches}}" wx:for-item="batch" wx:for-index="__i3__" wx:key="id"><view data-event-opts="{{[['tap',[['selectBatch',['$0'],[[['availableBatches','id',batch.id]]]]]]]}}" class="{{['batch-item','data-v-421059c6',(selectedBatch&&selectedBatch.id===batch.id)?'batch-item--selected':'',(batch.used)?'batch-item--disabled':'']}}" bindtap="__e"><text class="batch-name data-v-421059c6">{{batch.name}}</text><block wx:if="{{batch.used}}"><text class="batch-status data-v-421059c6">å·²å‡ºåº“</text></block></view></block></view></view></block><block wx:if="{{selectedBatch&&selectedOutboundDepartment}}"><view class="form-section data-v-421059c6"><text class="section-title data-v-421059c6">å‡ºåº“ç‰©æ–™æ¸…å•ï¼š</text><view class="outbound-preview data-v-421059c6"><block wx:for="{{outboundPreview}}" wx:for-item="item" wx:for-index="__i4__" wx:key="materialCode"><view class="preview-item data-v-421059c6"><view class="preview-info data-v-421059c6"><text class="preview-name data-v-421059c6">{{item.materialName}}</text><text class="preview-code data-v-421059c6">{{item.materialCode}}</text></view><view class="preview-quantity data-v-421059c6"><text class="{{['preview-workshop','data-v-421059c6',(item.workshopQuantity<item.outboundQuantity)?'insufficient':'']}}">{{"è½¦é—´ä»“: "+item.workshopQuantity}}</text><text class="preview-outbound data-v-421059c6">{{"å‡ºåº“é‡: "+item.outboundQuantity}}</text></view></view></block></view></view></block></view><view class="modal-actions data-v-421059c6"><view data-event-opts="{{[['tap',[['closeBatchOutboundModal',['$event']]]]]}}" class="modal-btn modal-cancel data-v-421059c6" bindtap="__e">å–æ¶ˆ</view><view data-event-opts="{{[['tap',[['confirmBatchOutbound',['$event']]]]]}}" class="{{['modal-btn','modal-confirm','data-v-421059c6',(!canConfirmOutbound)?'btn-disabled':'']}}" bindtap="__e">ç¡®è®¤å‡ºåº“</view></view></view></view></block></view></view>